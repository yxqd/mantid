from __future__ import (absolute_import, division, print_function)

import unittest
import numpy as np
import tempfile

from mantid import config
from testhelpers import run_algorithm
from mantid.simpleapi import (
    CreateWorkspace, GroupWorkspaces)
from mantid.api import mtd
from mantid.kernel import logger

class SANSWLNormCorrectionTest(unittest.TestCase):

    def setUp(self):
        config['default.instrument'] = 'EQSANS'
        config["default.facility"] = "SNS"

        x = np.array([0.00130935, 0.00327942, 0.00524949, 0.00721956, 0.00918963,
                      0.0111597, 0.01312977, 0.01509984, 0.01706991, 0.01903998,
                      0.02101005, 0.02298012, 0.02495019, 0.02692026, 0.02889033,
                      0.0308604, 0.03283047, 0.03480054, 0.03677061, 0.03874068,
                      0.04071075, 0.04268082, 0.04465089, 0.04662096, 0.04859103,
                      0.0505611, 0.05253117, 0.05450124, 0.05647131, 0.05844138,
                      0.06041145, 0.06238152, 0.06435159, 0.06632166, 0.06829173,
                      0.0702618, 0.07223187, 0.07420194, 0.07617201, 0.07814208,
                      0.08011215, 0.08208222, 0.08405229, 0.08602236, 0.08799243,
                      0.0899625, 0.09193257, 0.09390264, 0.09587271, 0.09784278,
                      0.09981285, 0.10178292, 0.10375299, 0.10572306, 0.10769313,
                      0.1096632, 0.11163327, 0.11360334, 0.11557341, 0.11754348,
                      0.11951355, 0.12148362, 0.12345369, 0.12542376, 0.12739383,
                      0.1293639, 0.13133397, 0.13330404, 0.13527411, 0.13724418,
                      0.13921425, 0.14118432, 0.14315439, 0.14512446, 0.14709453,
                      0.1490646, 0.15103467, 0.15300474, 0.15497481, 0.15694488,
                      0.15891495, 0.16088502, 0.16285509, 0.16482516, 0.16679523,
                      0.1687653, 0.17073537, 0.17270544, 0.17467551, 0.17664558,
                      0.17861565, 0.18058572, 0.18255579, 0.18452586, 0.18649593,
                      0.188466, 0.19043607, 0.19240614, 0.19437621, 0.19634628,
                      0.19831635, 0.20028642, 0.20225649, 0.20422656, 0.20619663,
                      0.2081667, 0.21013677, 0.21210684, 0.21407691, 0.21604698,
                      0.21801705, 0.21998712, 0.22195719, 0.22392726, 0.22589733,
                      0.2278674, 0.22983747, 0.23180754, 0.23377761, 0.23574768,
                      0.23771775, 0.23968782, 0.24165789, 0.24362796, 0.24559803,
                      0.2475681, 0.24953817, 0.25150824, 0.25347831, 0.25544838,
                      0.25741845, 0.25938852, 0.26135859, 0.26332866, 0.26529873,
                      0.2672688, 0.26923887, 0.27120894, 0.27317901, 0.27514908,
                      0.27711915, 0.27908922, 0.28105929, 0.28302936, 0.28499943,
                      0.2869695, 0.28893957, 0.29090964, 0.29287971, 0.29484978,
                      0.29681985, 0.29878992, 0.30075999, 0.30273006, 0.30470013,
                      0.3066702, 0.30864027, 0.31061034, 0.31258041, 0.31455048,
                      0.31652055, 0.31849062, 0.32046069, 0.32243076, 0.32440083,
                      0.3263709, 0.32834097, 0.33031104, 0.33228111, 0.33425118,
                      0.33622125, 0.33819132, 0.34016139, 0.34213146, 0.34410153,
                      0.3460716, 0.34804167, 0.35001174, 0.35198181, 0.35395188,
                      0.35592195, 0.35789202, 0.35986209, 0.36183216, 0.36380223,
                      0.3657723, 0.36774237, 0.36971244, 0.37168251, 0.37365258,
                      0.37562265, 0.37759272, 0.37956279, 0.38153286, 0.38350293,
                      0.385473, 0.38744307, 0.38941314, 0.39138321, 0.39335328,
                      0.395323])

        dx = np.array([0.00213893, 0.00223741, 0.00242322, 0.00267236, 0.0030468,
                       0.00336535, 0.00390019, 0.00435642, 0.00488964, 0.00545871,
                       0.00589238, 0.00633811, 0.00679822, 0.0072187, 0.00761406,
                       0.00816778, 0.00851525, 0.00896609, 0.00962625, 0.00982695,
                       0.01044435, 0.01090326, 0.01123537, 0.0119101, 0.01218639,
                       0.01266182, 0.01328729, 0.01361232, 0.01417535, 0.01465661,
                       0.0150407, 0.01549951, 0.01612685, 0.0164897, 0.01701417,
                       0.01757088, 0.01787065, 0.01855233, 0.01902717, 0.01930245,
                       0.0198731, 0.02031098, 0.02076287, 0.02134356, 0.0216352,
                       0.02211618, 0.02265912, 0.02306013, 0.02359848, 0.02419127,
                       0.02441525, 0.0251516, 0.02553055, 0.02584297, 0.02641014,
                       0.02681395, 0.02724208, 0.02786859, 0.02812569, 0.02874937,
                       0.02926952, 0.02950358, 0.03000794, 0.03063735, 0.0310253,
                       0.0315705, 0.03216146, 0.03240113, 0.03312014, 0.03360074,
                       0.03392025, 0.03467784, 0.03517257, 0.0356254, 0.03638645,
                       0.03667527, 0.03730583, 0.03811876, 0.03833341, 0.03910916,
                       0.03980288, 0.04022425, 0.04129004, 0.04152835, 0.04217247,
                       0.04318059, 0.04372019, 0.04436359, 0.0451441, 0.04561016,
                       0.04644029, 0.04716389, 0.04756891, 0.04855366, 0.04935675,
                       0.04961368, 0.05083514, 0.05160409, 0.05194813, 0.05321463,
                       0.0536972, 0.05494963, 0.05561698, 0.0566139, 0.05719773,
                       0.05811721, 0.05912665, 0.06019129, 0.06132599, 0.0617456,
                       0.0632101, 0.0641266, 0.06446526, 0.06608578, 0.06662594,
                       0.06746802, 0.06862169, 0.06909253, 0.07007931, 0.07095027,
                       0.07145579, 0.07257624, 0.07315847, 0.07410868, 0.0751839,
                       0.07569939, 0.07648209, 0.0777444, 0.07827776, 0.07941097,
                       0.08008094, 0.08104806, 0.08209321, 0.08257221, 0.0833534,
                       0.08448913, 0.0852602, 0.08591124, 0.08711631, 0.08792283,
                       0.08863702, 0.08961337, 0.09023084, 0.09116768, 0.09201231,
                       0.09278254, 0.09340822, 0.0940388, 0.09467968, 0.09531824,
                       0.09595279, 0.09657494, 0.09720316, 0.0978475, 0.09848713,
                       0.09912541, 0.09975187, 0.1003846, 0.10101448, 0.10164756,
                       0.10230172, 0.10294676, 0.10354801, 0.10418723, 0.10481543,
                       0.10543988, 0.10608625, 0.10673822, 0.10737222, 0.10800808,
                       0.10863414, 0.10924233, 0.10989509, 0.11053895, 0.11119593,
                       0.1118054, 0.11242776, 0.11306352, 0.11370695, 0.11431188,
                       0.11497988, 0.11559976, 0.11624149, 0.11681512, 0.11748153,
                       0.11812765, 0.11878045, 0.11934476, 0.12009559, 0.12061247,
                       0.12127375, 0.12170543, 0., 0., 0.,
                       0., 0., 0., 0., 0.])

        y1 = np.array([1.02666871e+01, 8.21720922e+00, 2.29661951e+01, 8.76153291e+01,
                       2.72612303e+02, 1.20785136e+03, 2.18088718e+03, 2.34416780e+03,
                       2.47899852e+03, 2.47210409e+03, 2.04263212e+03, 1.17439822e+03,
                       9.44479453e+02, 7.58690166e+02, 4.61847476e+02, 4.13591703e+02,
                       3.18819342e+02, 2.15202150e+02, 2.07639636e+02, 1.61911089e+02,
                       1.25152696e+02, 1.13133787e+02, 9.29624131e+01, 7.63948866e+01,
                       6.80706472e+01, 5.66934419e+01, 5.07358794e+01, 4.41018068e+01,
                       3.71875011e+01, 3.43002783e+01, 3.02315622e+01, 2.58122780e+01,
                       2.40104518e+01, 2.17039579e+01, 1.83506351e+01, 1.80248018e+01,
                       1.56384120e+01, 1.41631210e+01, 1.33567601e+01, 1.19913700e+01,
                       1.09685653e+01, 1.05151792e+01, 9.59582218e+00, 8.92913071e+00,
                       8.54614140e+00, 7.59516844e+00, 7.21148963e+00, 6.82837207e+00,
                       6.38033816e+00, 6.13594539e+00, 5.76990438e+00, 5.33325318e+00,
                       5.17731129e+00, 4.80798717e+00, 4.70281073e+00, 4.48388889e+00,
                       4.24126335e+00, 4.10415007e+00, 3.90038361e+00, 3.71793961e+00,
                       3.64666587e+00, 3.56112714e+00, 3.28251348e+00, 3.21327671e+00,
                       3.23539115e+00, 2.93320732e+00, 3.00795580e+00, 2.86079374e+00,
                       2.76142078e+00, 2.75034341e+00, 2.60616745e+00, 2.60046682e+00,
                       2.49022963e+00, 2.44007717e+00, 2.44726107e+00, 2.37588194e+00,
                       2.23228436e+00, 2.26498854e+00, 2.21977256e+00, 2.13628100e+00,
                       2.12491337e+00, 2.13754117e+00, 2.02770027e+00, 2.04733141e+00,
                       1.93282671e+00, 1.94715679e+00, 1.93935106e+00, 1.85435799e+00,
                       1.85036247e+00, 1.83943391e+00, 1.81994650e+00, 1.76129407e+00,
                       1.76299053e+00, 1.73118680e+00, 1.75633000e+00, 1.68553400e+00,
                       1.69132695e+00, 1.70128998e+00, 1.68114778e+00, 1.63249546e+00,
                       1.65114546e+00, 1.63807315e+00, 1.65459847e+00, 1.62128762e+00,
                       1.59698256e+00, 1.58940455e+00, 1.59045565e+00, 1.56313008e+00,
                       1.53881812e+00, 1.55109589e+00, 1.53183045e+00, 1.56515223e+00,
                       1.48442475e+00, 1.51166018e+00, 1.49725154e+00, 1.48154141e+00,
                       1.49503426e+00, 1.45661005e+00, 1.47384344e+00, 1.47917336e+00,
                       1.44716298e+00, 1.43457446e+00, 1.41514326e+00, 1.43888157e+00,
                       1.40319622e+00, 1.40966479e+00, 1.42097095e+00, 1.40511847e+00,
                       1.39625054e+00, 1.40481741e+00, 1.35941773e+00, 1.37582316e+00,
                       1.35158929e+00, 1.34306130e+00, 1.38389522e+00, 1.38119020e+00,
                       1.37388094e+00, 1.35041000e+00, 1.36381060e+00, 1.34663005e+00,
                       1.35001540e+00, 1.36191943e+00, 1.30540088e+00, 1.34652234e+00,
                       1.34607106e+00, 1.29822373e+00, 1.26703171e+00, 1.32705986e+00,
                       1.31648835e+00, 1.33697134e+00, 1.32347712e+00, 1.32692453e+00,
                       1.32957805e+00, 1.30917334e+00, 1.22708775e+00, 1.31254877e+00,
                       1.25681800e+00, 1.26230866e+00, 1.29243049e+00, 1.28493098e+00,
                       1.33207361e+00, 1.22138436e+00, 1.31929268e+00, 1.32361230e+00,
                       1.28200954e+00, 1.30842925e+00, 1.25063243e+00, 1.30192948e+00,
                       1.29627703e+00, 1.32027500e+00, 1.33424290e+00, 1.25737913e+00,
                       1.33417752e+00, 1.18360574e+00, 1.27459632e+00, 1.25174921e+00,
                       1.32495408e+00, 1.21481857e+00, 1.20580008e+00, 1.25950298e+00,
                       1.33852302e+00, 1.25056046e+00, 1.30880106e+00, 1.25722941e+00,
                       1.14357131e+00, 1.14403827e+00, 1.45751196e+00, 1.01586918e+00,
                       1.25239598e+00, 9.59712679e-01, 1.17348326e+00, 1.36068191e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00])

        e1 = np.array([1.96667722e-01, 5.24701381e-02, 2.20029318e-01, 3.54047164e-01,
                       1.10780298e+00, 5.53607366e+00, 5.32508464e+00, 6.31877429e+00,
                       5.68806422e+00, 4.59424568e+00, 3.97857269e+00, 1.85480399e+00,
                       1.32559936e+00, 1.27107702e+00, 5.46391870e-01, 4.67504907e-01,
                       4.22234289e-01, 2.23240509e-01, 1.89739369e-01, 1.82719688e-01,
                       1.03247247e-01, 9.86304628e-02, 8.39000762e-02, 5.52837056e-02,
                       5.55488762e-02, 4.48333902e-02, 3.29818781e-02, 3.22201417e-02,
                       2.41761302e-02, 2.03980888e-02, 2.03458902e-02, 1.52340367e-02,
                       1.29736351e-02, 1.37643216e-02, 9.38797322e-03, 9.41007799e-03,
                       8.95747171e-03, 6.50955999e-03, 6.44852514e-03, 5.75375753e-03,
                       5.01260479e-03, 4.86391239e-03, 4.36030351e-03, 3.70665105e-03,
                       3.77255186e-03, 3.45238074e-03, 2.87050952e-03, 3.05041394e-03,
                       2.47614623e-03, 2.22419921e-03, 2.50567997e-03, 1.79801026e-03,
                       1.92277562e-03, 1.86716983e-03, 1.72211135e-03, 1.77770263e-03,
                       1.55357011e-03, 1.45499509e-03, 1.47116900e-03, 1.26599470e-03,
                       1.24739461e-03, 1.29924246e-03, 1.17006385e-03, 1.03088626e-03,
                       1.13265182e-03, 9.03672520e-04, 8.84368133e-04, 9.42022374e-04,
                       7.62634296e-04, 8.09039784e-04, 7.81703617e-04, 7.03405567e-04,
                       7.13864735e-04, 6.60316140e-04, 6.22964642e-04, 6.73937867e-04,
                       5.78026573e-04, 5.67505615e-04, 6.01276714e-04, 5.23607433e-04,
                       5.07967399e-04, 5.55925041e-04, 4.55329540e-04, 4.86719067e-04,
                       4.66808570e-04, 4.31241040e-04, 4.48929740e-04, 4.25527639e-04,
                       3.94229909e-04, 4.19796716e-04, 4.00078411e-04, 3.59633301e-04,
                       4.00280200e-04, 3.58412708e-04, 3.48754774e-04, 3.76349343e-04,
                       3.30899294e-04, 3.34615724e-04, 3.48495034e-04, 3.04963545e-04,
                       3.28353272e-04, 3.17702964e-04, 3.10823478e-04, 3.12260442e-04,
                       3.00895166e-04, 2.85000132e-04, 3.04292463e-04, 2.82409676e-04,
                       2.66306089e-04, 2.95568938e-04, 2.64071265e-04, 2.64578955e-04,
                       2.76966670e-04, 2.42481901e-04, 2.57263519e-04, 2.59793612e-04,
                       2.49292928e-04, 2.56156379e-04, 2.48597686e-04, 2.55695461e-04,
                       2.66214661e-04, 2.46471240e-04, 2.52701514e-04, 2.63712928e-04,
                       2.34097006e-04, 2.65950788e-04, 2.76184926e-04, 2.50652360e-04,
                       2.79184363e-04, 2.72588639e-04, 2.64459794e-04, 2.84820591e-04,
                       2.63762936e-04, 2.79578551e-04, 3.21557088e-04, 2.88348814e-04,
                       3.23159852e-04, 3.35905855e-04, 3.01802351e-04, 3.44956949e-04,
                       3.49418531e-04, 3.81656387e-04, 3.83718554e-04, 4.08182370e-04,
                       4.28048781e-04, 4.19777228e-04, 4.44582878e-04, 4.55655742e-04,
                       4.88489920e-04, 5.05804673e-04, 5.39788058e-04, 5.55792029e-04,
                       5.75455018e-04, 5.79626105e-04, 5.82724573e-04, 6.35017708e-04,
                       6.69893260e-04, 6.68669506e-04, 7.55834289e-04, 7.35440652e-04,
                       8.22260665e-04, 8.25107387e-04, 9.65899678e-04, 9.60508138e-04,
                       1.02466590e-03, 1.09044845e-03, 1.08844517e-03, 1.24269524e-03,
                       1.40732801e-03, 1.45382977e-03, 1.70682734e-03, 1.69092621e-03,
                       1.85808507e-03, 1.77333443e-03, 2.25015213e-03, 2.48712531e-03,
                       2.70079798e-03, 2.92816656e-03, 2.99786686e-03, 3.58094956e-03,
                       4.09990572e-03, 4.33217100e-03, 5.49029887e-03, 5.89790420e-03,
                       6.08262630e-03, 7.60949793e-03, 1.45504037e-02, 1.15954716e-02,
                       1.66862666e-02, 2.55848194e-02, 3.12970882e-02, 1.08909933e-01,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00])

        y2 = np.array([2.52520061e+01, 4.45062719e+01, 2.23741612e+02, 1.88581296e+03,
                       5.92331151e+03, 5.62780385e+03, 6.54765167e+03, 6.55064864e+03,
                       3.54188887e+03, 2.59759850e+03, 1.51193491e+03, 1.16873194e+03,
                       8.20771534e+02, 6.14138659e+02, 4.84118511e+02, 3.53797220e+02,
                       2.95903351e+02, 2.27475818e+02, 1.92494155e+02, 1.52164498e+02,
                       1.29658716e+02, 1.06051677e+02, 9.40709538e+01, 7.55403963e+01,
                       6.78440983e+01, 5.59044778e+01, 5.04553481e+01, 4.27929267e+01,
                       3.86863753e+01, 3.37579016e+01, 3.01574558e+01, 2.74550477e+01,
                       2.38619160e+01, 2.21338455e+01, 1.94221674e+01, 1.80806207e+01,
                       1.61754790e+01, 1.50661082e+01, 1.34703724e+01, 1.26463777e+01,
                       1.15317980e+01, 1.07667646e+01, 9.81671167e+00, 9.37271664e+00,
                       8.65145424e+00, 8.15334102e+00, 7.71013807e+00, 6.99145686e+00,
                       6.59043496e+00, 6.22685483e+00, 5.96958039e+00, 5.51376982e+00,
                       5.32814448e+00, 5.03318318e+00, 4.87662460e+00, 4.50233648e+00,
                       4.38914813e+00, 4.20522091e+00, 4.04517716e+00, 3.87167536e+00,
                       3.67799877e+00, 3.56141182e+00, 3.45342582e+00, 3.37088392e+00,
                       3.15481356e+00, 3.08743785e+00, 3.01333610e+00, 2.86052832e+00,
                       2.75628676e+00, 2.75577342e+00, 2.60452133e+00, 2.58298844e+00,
                       2.53856410e+00, 2.51905736e+00, 2.43603132e+00, 2.40516131e+00,
                       2.33527040e+00, 2.27873761e+00, 2.23844566e+00, 2.22537624e+00,
                       2.18350580e+00, 2.07994702e+00, 2.10845659e+00, 2.05224970e+00,
                       2.03539646e+00, 1.99776803e+00, 1.92597438e+00, 1.90709126e+00,
                       1.92595873e+00, 1.90217910e+00, 1.86505361e+00, 1.84118858e+00,
                       1.84473943e+00, 1.79190371e+00, 1.78513254e+00, 1.75357445e+00,
                       1.75237069e+00, 1.72476626e+00, 1.72396984e+00, 1.69693414e+00,
                       1.66292038e+00, 1.61578298e+00, 1.64794559e+00, 1.57899026e+00,
                       1.59239844e+00, 1.61831344e+00, 1.61505645e+00, 1.58019587e+00,
                       1.55732190e+00, 1.55391853e+00, 1.50148302e+00, 1.55237245e+00,
                       1.53229122e+00, 1.51300305e+00, 1.51260321e+00, 1.49514743e+00,
                       1.46505293e+00, 1.47140744e+00, 1.48363927e+00, 1.45118860e+00,
                       1.43496072e+00, 1.42805677e+00, 1.44531568e+00, 1.45090186e+00,
                       1.39296932e+00, 1.45238274e+00, 1.41889387e+00, 1.38755206e+00,
                       1.44009309e+00, 1.33944038e+00, 1.41229995e+00, 1.31647409e+00,
                       1.35790604e+00, 1.46768436e+00, 1.40475502e+00, 1.32571328e+00,
                       1.33326836e+00, 1.29807476e+00, 1.21015775e+00, 1.22515526e+00,
                       1.26011722e+00, 1.25287472e+00, 1.30433400e+00, 1.33530986e+00,
                       9.71757503e-01, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00])

        e2 = np.array([2.44729468e-01, 4.31451034e-01, 1.18589389e+00, 9.34281485e+00,
                       2.15002967e+01, 1.72725349e+01, 1.77453974e+01, 1.24357209e+01,
                       7.09604706e+00, 4.01783469e+00, 2.56428520e+00, 1.51735203e+00,
                       1.14021594e+00, 7.02035019e-01, 5.75728497e-01, 3.40618085e-01,
                       3.25147549e-01, 1.87875516e-01, 1.86796485e-01, 1.18913582e-01,
                       1.06320020e-01, 8.01881078e-02, 6.55937200e-02, 5.43016476e-02,
                       4.24784144e-02, 3.65796505e-02, 3.02929663e-02, 2.60994723e-02,
                       2.08653006e-02, 2.02751590e-02, 1.51468235e-02, 1.54575788e-02,
                       1.09927840e-02, 1.17281691e-02, 9.09398683e-03, 9.12699954e-03,
                       7.36884958e-03, 6.70702393e-03, 5.84184160e-03, 5.21377406e-03,
                       5.07838191e-03, 4.63728484e-03, 4.15231422e-03, 3.85343580e-03,
                       3.70104226e-03, 3.14305782e-03, 3.22875342e-03, 2.61847366e-03,
                       2.62906800e-03, 2.12207582e-03, 2.25891447e-03, 1.79608024e-03,
                       1.85492713e-03, 1.65415505e-03, 1.52987346e-03, 1.41668606e-03,
                       1.32432317e-03, 1.30974328e-03, 1.14720277e-03, 1.15726734e-03,
                       9.99989886e-04, 1.04634743e-03, 9.07840929e-04, 9.71446104e-04,
                       7.87356332e-04, 8.46570930e-04, 7.49323712e-04, 7.46394054e-04,
                       6.67416639e-04, 6.83008821e-04, 6.40325325e-04, 6.09640447e-04,
                       6.01828480e-04, 5.66481167e-04, 5.68693268e-04, 5.27094863e-04,
                       5.21720847e-04, 4.91454064e-04, 5.01370236e-04, 4.56017981e-04,
                       4.87549921e-04, 4.12847462e-04, 4.49009144e-04, 4.00244939e-04,
                       4.20811265e-04, 3.92518068e-04, 3.72956037e-04, 3.76232541e-04,
                       3.78854260e-04, 3.70010121e-04, 3.83175453e-04, 3.67561138e-04,
                       3.79980481e-04, 3.64178137e-04, 3.66713218e-04, 3.83663209e-04,
                       3.73809102e-04, 4.02932977e-04, 3.72678509e-04, 4.06324344e-04,
                       3.76185630e-04, 4.23828868e-04, 4.02931576e-04, 4.41750393e-04,
                       4.20734003e-04, 4.59548854e-04, 5.14078865e-04, 5.18489522e-04,
                       5.57278563e-04, 5.73559810e-04, 5.72201101e-04, 6.30199576e-04,
                       6.60460710e-04, 6.84568998e-04, 7.23131493e-04, 7.57534622e-04,
                       7.85938281e-04, 8.34640387e-04, 8.88298032e-04, 9.34737704e-04,
                       9.71744716e-04, 1.04421953e-03, 1.12611993e-03, 1.26206885e-03,
                       1.24863354e-03, 1.49181719e-03, 1.53684945e-03, 1.68591307e-03,
                       1.99220055e-03, 1.99124458e-03, 2.36327342e-03, 2.47941805e-03,
                       3.03276131e-03, 3.61427765e-03, 3.85419339e-03, 4.00347245e-03,
                       5.03573177e-03, 5.23293744e-03, 6.10203352e-03, 8.72681558e-03,
                       1.01788619e-02, 1.68785159e-02, 1.97824973e-02, 4.05241057e-02,
                       5.90197349e-02, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00])

        y3 = np.array([9.05373149e+01, 2.85014804e+02, 2.24205019e+03, 1.04605690e+04,
                       1.50265031e+04, 1.38618180e+04, 8.14379066e+03, 5.36086124e+03,
                       3.02460703e+03, 2.20435332e+03, 1.39604916e+03, 1.00494592e+03,
                       7.57127319e+02, 5.45959970e+02, 4.52802083e+02, 3.31666923e+02,
                       2.69905482e+02, 2.14224386e+02, 1.73266261e+02, 1.47365523e+02,
                       1.18456958e+02, 1.03181912e+02, 8.45572844e+01, 7.25232038e+01,
                       6.33516118e+01, 5.41649348e+01, 4.84876692e+01, 4.15459683e+01,
                       3.69447130e+01, 3.31350448e+01, 2.87057637e+01, 2.64610850e+01,
                       2.33063444e+01, 2.11024577e+01, 1.90626745e+01, 1.72560638e+01,
                       1.60456655e+01, 1.43682109e+01, 1.30775544e+01, 1.21920194e+01,
                       1.10828374e+01, 1.02168788e+01, 9.53506695e+00, 9.01704701e+00,
                       8.27299280e+00, 7.60327190e+00, 7.16693286e+00, 6.66822998e+00,
                       6.37612892e+00, 5.86418086e+00, 5.57910756e+00, 5.22172271e+00,
                       5.01627384e+00, 4.73278748e+00, 4.47267317e+00, 4.31852299e+00,
                       4.02270300e+00, 3.91187430e+00, 3.82844854e+00, 3.55562170e+00,
                       3.49691650e+00, 3.31944922e+00, 3.24719790e+00, 3.11263575e+00,
                       3.01810710e+00, 2.85189033e+00, 2.82845139e+00, 2.74330497e+00,
                       2.68033090e+00, 2.54048826e+00, 2.56090629e+00, 2.46094633e+00,
                       2.34072191e+00, 2.31781753e+00, 2.23735518e+00, 2.24175265e+00,
                       2.14499505e+00, 2.12359416e+00, 2.04715957e+00, 2.01110562e+00,
                       2.03086960e+00, 1.92071431e+00, 1.87793300e+00, 1.86943792e+00,
                       1.83801324e+00, 1.77614734e+00, 1.74308214e+00, 1.70678633e+00,
                       1.70212018e+00, 1.70258647e+00, 1.64941703e+00, 1.68364635e+00,
                       1.62196853e+00, 1.60645312e+00, 1.62350451e+00, 1.61442389e+00,
                       1.53277098e+00, 1.58295181e+00, 1.58492094e+00, 1.52986195e+00,
                       1.49722096e+00, 1.48127609e+00, 1.42070328e+00, 1.47158640e+00,
                       1.43794987e+00, 1.55902251e+00, 1.38811893e+00, 1.28292297e+00,
                       1.36785270e+00, 1.36721309e+00, 1.05790365e+00, 1.20189119e+00,
                       1.33029325e+00, 1.44231770e+00, 1.52809243e+00, 1.86870048e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00])

        e3 = np.array([9.20705933e-01, 2.32110220e+00, 1.37816209e+01, 3.67785720e+01,
                       5.51146856e+01, 3.11106993e+01, 1.85629077e+01, 1.00447645e+01,
                       4.95711100e+00, 3.49970162e+00, 1.76637196e+00, 1.30065953e+00,
                       8.28202665e-01, 6.13451420e-01, 4.39058095e-01, 2.88874845e-01,
                       2.41537859e-01, 1.68550345e-01, 1.42528916e-01, 1.05741378e-01,
                       8.21112353e-02, 7.30869336e-02, 5.00974903e-02, 4.72724058e-02,
                       3.59745187e-02, 3.04444489e-02, 2.75430296e-02, 2.18525393e-02,
                       2.01514474e-02, 1.63284627e-02, 1.41919641e-02, 1.24431870e-02,
                       1.09944229e-02, 1.05036442e-02, 8.55139564e-03, 7.87284713e-03,
                       7.32224351e-03, 6.27799474e-03, 5.77755583e-03, 4.66775223e-03,
                       4.33606975e-03, 3.80682398e-03, 3.46702978e-03, 3.32387965e-03,
                       2.71407957e-03, 2.64931584e-03, 2.30195188e-03, 2.22552379e-03,
                       1.99831010e-03, 1.75777414e-03, 1.72342892e-03, 1.49776063e-03,
                       1.48089161e-03, 1.33513399e-03, 1.21825923e-03, 1.23410860e-03,
                       1.01717995e-03, 1.05457411e-03, 9.91689928e-04, 8.86514011e-04,
                       9.02343081e-04, 7.76467995e-04, 7.92633423e-04, 7.41342230e-04,
                       7.14044314e-04, 6.48903944e-04, 6.28207455e-04, 6.17121799e-04,
                       5.79468557e-04, 5.58317398e-04, 5.65323022e-04, 5.41371473e-04,
                       5.45829425e-04, 5.09757794e-04, 5.03046230e-04, 5.35597280e-04,
                       5.08179202e-04, 5.50702144e-04, 5.02688072e-04, 5.18670344e-04,
                       5.62454178e-04, 5.36452463e-04, 5.86995269e-04, 5.57212427e-04,
                       6.21815880e-04, 6.54507872e-04, 6.83545739e-04, 7.26107514e-04,
                       7.49414269e-04, 8.23997434e-04, 8.35050975e-04, 9.13824821e-04,
                       9.45310550e-04, 1.03022274e-03, 1.09641556e-03, 1.18149592e-03,
                       1.24175490e-03, 1.34140815e-03, 1.53826574e-03, 1.60637593e-03,
                       1.82398826e-03, 2.02602862e-03, 2.19392002e-03, 2.60912756e-03,
                       2.99234206e-03, 3.55345227e-03, 4.03958314e-03, 4.16682726e-03,
                       5.37651545e-03, 6.42363499e-03, 6.39521730e-03, 9.69494209e-03,
                       1.73498579e-02, 3.05924685e-02, 5.18905306e-02, 3.17459398e-01,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
                       0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00])

        ws1 = CreateWorkspace(DataX=x, DataY=y1, DataE=e1, NSpec=1)
        ws1.setDx(0, dx)
        ws1.run().addProperty("wavelength_min", 2.6, "Angstrom", True)
        ws1.run().addProperty("wavelength_max", 3.6, "Angstrom", True)

        ws2 = CreateWorkspace(DataX=x, DataY=y2, DataE=e2, NSpec=1)
        ws2.setDx(0, dx)
        ws2.run().addProperty("wavelength_min", 3.6, "Angstrom", True)
        ws2.run().addProperty("wavelength_max", 4.6, "Angstrom", True)

        ws3 = CreateWorkspace(DataX=x, DataY=y3, DataE=e3, NSpec=1)
        ws3.setDx(0, dx)
        ws3.run().addProperty("wavelength_min", 4.6, "Angstrom", True)
        ws3.run().addProperty("wavelength_max", 5.6, "Angstrom", True)

        self.ws = GroupWorkspaces([ws1, ws2, ws3], OutputWorkspace='ws_group')

    def test_minimal_params(self):
        alg_test = run_algorithm(
            "SANSWLNormCorrection",
            InputWorkspaces=self.ws,
            OutputWorkspacePrefix="out",
            OutputDirectory=tempfile.gettempdir(),
        )
        self.assertTrue(alg_test.isExecuted())
        out_trimmed_fit_averaged = mtd["out_trimmed_fit_averaged"]
        self.assertTrue(
            np.allclose(np.array([6.22315707e+01, 6.99905487e+01, 1.58317252e+02, 6.26789526e+02,
                                  1.26769810e+03, 1.50973597e+03, 1.74378416e+03, 1.70700541e+03,
                                  1.35536296e+03, 1.22573534e+03, 9.40617273e+02, 6.01870041e+02,
                                  4.80101233e+02, 3.89267025e+02, 2.73437992e+02, 2.39519153e+02,
                                  1.99744580e+02, 1.56102246e+02, 1.48516759e+02, 1.28136113e+02,
                                  1.12540807e+02, 1.05523335e+02, 9.69137873e+01, 8.90261945e+01,
                                  8.51319016e+01, 7.97685036e+01, 7.70168381e+01, 7.37628702e+01,
                                  7.08703586e+01, 6.92588927e+01, 6.73743525e+01, 6.55402406e+01,
                                  6.44540243e+01, 6.34290638e+01, 6.19560258e+01, 6.16454283e+01,
                                  6.06076913e+01, 5.99428631e+01, 5.94620447e+01, 5.88902225e+01,
                                  5.83943587e+01, 5.81334477e+01, 5.77036065e+01, 5.74171545e+01,
                                  5.71883700e+01, 5.67964171e+01, 5.66070731e+01, 5.63865892e+01,
                                  5.61850199e+01, 5.60480799e+01, 5.58893493e+01, 5.56836047e+01,
                                  5.56051402e+01, 5.54413623e+01, 5.53811109e+01, 5.52632903e+01,
                                  5.51606574e+01, 5.50917614e+01, 5.50040871e+01, 5.49158611e+01,
                                  5.48695898e+01, 5.48228503e+01, 5.47161268e+01, 5.46798504e+01,
                                  5.46611505e+01, 5.45477958e+01, 5.45640660e+01, 5.44959723e+01,
                                  5.44496988e+01, 5.44413527e+01, 5.43778914e+01, 5.43704154e+01,
                                  5.43249946e+01, 5.43054508e+01, 5.42963757e+01, 5.42694466e+01,
                                  5.42109710e+01, 5.42151607e+01, 5.41932929e+01, 5.41628878e+01,
                                  5.41552988e+01, 5.41448797e+01, 5.41098890e+01, 5.41101800e+01,
                                  5.40691872e+01, 5.40679303e+01, 5.40566112e+01, 5.40250797e+01,
                                  5.40255996e+01, 5.40194449e+01, 5.40072550e+01, 5.39862937e+01,
                                  5.39852081e+01, 5.39684815e+01, 5.39767038e+01, 5.39494527e+01,
                                  5.39485704e+01, 5.39506081e+01, 5.39438741e+01, 5.39229728e+01,
                                  5.39245012e+01, 5.39146099e+01, 5.39215443e+01, 5.39047859e+01,
                                  5.38970029e+01, 5.39012128e+01, 5.38955964e+01, 5.38793235e+01,
                                  5.38715818e+01, 5.38752916e+01, 5.38531248e+01, 5.38743757e+01,
                                  5.38495553e+01, 5.38602682e+01, 5.38582437e+01, 5.38623537e+01,
                                  2.76649695e+01, 2.76467704e+01, 2.76573370e+01, 2.76548290e+01,
                                  2.76362369e+01, 2.76288421e+01, 2.76218777e+01, 2.76346374e+01,
                                  2.76075596e+01, 2.76202650e+01, 2.76205796e+01, 2.76076572e+01,
                                  2.76115988e+01, 2.75998371e+01, 2.75887519e+01, 2.75816790e+01,
                                  2.75761667e+01, 2.75894025e+01, 2.75997879e+01, 2.75858353e+01,
                                  2.75833850e+01, 2.75660393e+01, 2.75587247e+01, 2.75525252e+01,
                                  2.75597912e+01, 2.75645887e+01, 2.75445326e+01, 2.75700312e+01,
                                  2.75118514e+01, 1.29822373e+00, 1.26703171e+00, 1.32705986e+00,
                                  1.31648835e+00, 1.33697134e+00, 1.32347712e+00, 1.32692453e+00,
                                  1.32957805e+00, 1.30917334e+00, 1.22708775e+00, 1.31254877e+00,
                                  1.25681800e+00, 1.26230866e+00, 1.29243049e+00, 1.28493098e+00,
                                  1.33207361e+00, 1.22138436e+00, 1.31929268e+00, 1.32361230e+00,
                                  1.28200954e+00, 1.30842925e+00, 1.25063243e+00, 1.30192948e+00,
                                  1.29627703e+00, 1.32027500e+00, 1.33424290e+00, 1.25737913e+00,
                                  1.33417752e+00, 1.18360574e+00, 1.27459632e+00, 1.25174921e+00,
                                  1.32495408e+00, 1.21481857e+00, 1.20580008e+00, 1.25950298e+00,
                                  1.33852302e+00, 1.25056046e+00, 1.30880106e+00, 1.25722941e+00,
                                  1.14357131e+00, 1.14403827e+00, 1.45751196e+00, 1.01586918e+00,
                                  1.25239598e+00, 9.59712679e-01, 1.17348326e+00, 1.36068191e+00]),
                        out_trimmed_fit_averaged.readY(0)))



if __name__ == '__main__':
    unittest.main()
